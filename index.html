<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">

<meta property="og:title" content="灯光方案对比展示">
<meta property="og:description" content="多状态灯光方案交互对比视图">
<meta property="og:image" content="layer4.png">

<title>Lighting Compare</title>

<style>
html,body{
  margin:0;
  height:100%;
  background:#111;
  overflow:hidden;
  font-family:system-ui;
}

#viewer{
  position:relative;
  width:100%;
  height:100%;
  overflow: hidden; /* 确保分割线不会超出容器 */
}

.layer{
  position:absolute;
  inset:0;
  background-size:cover;
  background-position:center;
  transition:clip-path .6s ease, opacity .4s ease;
  cursor:pointer;
}

/* 分割线元素 */
.split-line {
  position: absolute;
  background-color: rgba(200, 200, 200, 0.8); /* 白色半透明线，可以根据需要调整颜色和透明度 */
  z-index: 5; /* 在图层之上但在UI之下 */
  transform-origin: top left;
}

#ui{
  position:fixed;
  top:20px;
  right:20px;
  z-index:10;
}

button{
  padding:10px 16px;
  background:#222;
  color:#fff;
  border:1px solid #444;
  border-radius:6px;
  cursor:pointer;
}

.label{
  position:absolute;
  color:#fff;
  font-style:italic;
  opacity:.85;
  text-shadow:0 2px 6px #000;
  transition:opacity .4s;
  white-space: nowrap; /* 防止文字换行 */
  letter-spacing: 2px; /* 调整字符间距 */
  transform: rotate(70deg); /* 旋转角度与分割线倾斜角度匹配 */
  transform-origin: top left; /* 设置旋转原点 */
}

.hidden{opacity:0;pointer-events:none;}
</style>
</head>

<body>

<div id="ui">
  <button id="toggle">图层视图</button>
</div>

<div id="viewer">

  <div class="layer" data-id="0" style="background-image:url(layer1.png)"></div>
  <div class="layer" data-id="1" style="background-image:url(layer2.png)"></div>
  <div class="layer" data-id="2" style="background-image:url(layer3.png)"></div>
  <div class="layer" data-id="3" style="background-image:url(layer4.png)"></div>
  
  <!-- 分割线元素 -->
  <div class="split-line" id="split-line-1"></div>
  <div class="split-line" id="split-line-2"></div>
  <div class="split-line" id="split-line-3"></div>

  <div class="label" style="top:2%; left:17%;">灯光点位</div>
  <div class="label" style="top:2%; left:42%;">白模</div>
  <div class="label" style="top:2%; left:67%;">白模灯光</div>

</div>

<script>
const viewer = document.getElementById("viewer");
const layers = document.querySelectorAll(".layer");
const labels = document.querySelectorAll(".label");
const toggle = document.getElementById("toggle");

let split = true;   // 默认图层视图
let focus = null;

/* 纵向左倾斜切（等距平行） - 3条分割线，4个区域 */
const cuts = [
  "polygon(0 0, 18% 0, 33% 100%, 0 100%)",      // 区域1
  "polygon(18% 0, 43% 0, 58% 100%, 33% 100%)",   // 区域2
  "polygon(43% 0, 68% 0, 83% 100%, 58% 100%)",   // 区域3
  "polygon(68% 0, 100% 0, 100% 100%, 83% 100%)"  // 区域4
];

// 分割线的坐标数据 [x1, y1, x2, y2] 百分比形式
const splitLines = [
  [18, 0, 33, 100],   // 第一条分割线：从 (18%, 0%) 到 (33%, 100%)
  [43, 0, 58, 100],   // 第二条分割线：从 (43%, 0%) 到 (58%, 100%)
  [68, 0, 83, 100]    // 第三条分割线：从 (68%, 0%) 到 (83%, 100%)
];

function showMain(){
  layers.forEach((l,i)=>{
    l.style.clipPath = i===3 ? "none" : "polygon(0 0,0 0,0 0,0 0)";
  });
  
  // 隐藏分割线
  document.querySelectorAll('.split-line').forEach(line => {
    line.style.display = 'none';
  });
  
  labels.forEach(l=>l.classList.add("hidden"));
  viewer.classList.remove("split");
  split = false;
  focus = null;
}

function showSplit(){
  layers.forEach((l,i)=>{
    l.style.clipPath = cuts[i];
  });
  
  // 显示并精确定位分割线
  const viewerRect = viewer.getBoundingClientRect();
  const viewerWidth = viewerRect.width;
  const viewerHeight = viewerRect.height;
  
  document.querySelectorAll('.split-line').forEach((line, index) => {
    const [x1, y1, x2, y2] = splitLines[index];
    
    // 将百分比转换为像素值
    const x1Px = (x1 / 100) * viewerWidth;
    const y1Px = (y1 / 100) * viewerHeight;
    const x2Px = (x2 / 100) * viewerWidth;
    const y2Px = (y2 / 100) * viewerHeight;
    
    // 计算线的长度（两点间距离）
    const length = Math.sqrt(Math.pow(x2Px - x1Px, 2) + Math.pow(y2Px - y1Px, 2));
    
    // 计算旋转角度（弧度转角度）
    const angle = Math.atan2(y2Px - y1Px, x2Px - x1Px) * 180 / Math.PI;
    
    // 设置分割线的样式
    line.style.width = `${length}px`;
    line.style.height = '2px';  // 线的厚度
    line.style.left = `${x1Px}px`;
    line.style.top = `${y1Px}px`;
    line.style.transform = `rotate(${angle}deg)`;
    line.style.transformOrigin = '0 0';  // 左上角作为旋转中心
    line.style.display = 'block';
  });
  
  labels.forEach(l=>l.classList.remove("hidden"));
  viewer.classList.add("split");
  split = true;
}

// 监听窗口大小变化，重新定位分割线
window.addEventListener('resize', () => {
  if(split) {
    showSplit();
  }
});

toggle.onclick = ()=>{
  split ? showMain() : showSplit();
};

layers.forEach((layer,i)=>{
  layer.onclick = ()=>{
    if(!split) return;

    if(focus === i){
      showSplit();
      focus = null;
      return;
    }

    layers.forEach((l,idx)=>{
      l.style.clipPath = idx===i ? "none" : "polygon(0 0,0 0,0 0,0 0)";
    });

    // 在单个图层聚焦模式下隐藏分割线
    document.querySelectorAll('.split-line').forEach(line => {
      line.style.display = 'none';
    });
    
    labels.forEach(l=>l.classList.add("hidden"));
    focus = i;
  };
});

/* 默认进入即为图层视图 */
showSplit();
</script>

</body>
</html>
